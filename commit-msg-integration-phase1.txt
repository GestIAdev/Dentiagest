PHASE 1: INTEGRATION SCHEMA PREP - Documents Module Cross-Domain Support

ğŸ¯ OBJECTIVE:
Enable Documents module to support both MEDICAL and ADMINISTRATIVE domains
through flexible relationship fields, preparing for full integration.

ğŸ“Š CHANGES SUMMARY:

1. Documents.ts Interface (Backend Model):
   - Added appointment_id (medical domain)
   - Added medical_record_id (clinical files)
   - Added treatment_id (billing/invoices)
   - Added purchase_order_id (marketplace supplier invoices)
   - Added subscription_id (Netflix Dental receipts)
   - Updated DocumentSearchCriteria with all new filters

2. resolvers.ts (GraphQL Resolvers):
   - Updated DocumentV3 type resolvers (6 new fields)
   - Enhanced documentsV3 query with multi-filter logic:
     * patientId (existing)
     * appointmentId (NEW)
     * medicalRecordId (NEW)
     * treatmentId (NEW)
     * purchaseOrderId (NEW)
     * subscriptionId (NEW)
   - createDocumentV3 mutation: Already supports new fields via spread operator
   - updateDocumentV3 mutation: Already supports new fields via spread operator

3. schema.ts (GraphQL Schema):
   - DocumentV3 type: Added 6 new optional relationship fields
   - UnifiedDocumentV3 type: Added treatment_id, purchase_order_id, subscription_id
   - DocumentV3Input: Added all 6 new optional fields
   - UpdateDocumentV3Input: Added all 6 new optional fields
   - documentsV3 query: Updated parameters to accept all filters

4. constants.ts (NEW FILE - Virtual Patient):
   - Created VIRTUAL_PATIENT constants object
   - ID: 'd76a8a03-1411-4143-85ba-6f064c7b564b'
   - Helper functions:
     * isVirtual(patientId) - Check if Virtual Patient
     * getDisplayName() - Get formatted name with icon
   - Documentation of EXCLUDED_FROM and INCLUDED_IN contexts
   - Use cases for legal, financial, HR, operational documents
   - RBAC permissions requirements
   - Scalability plan for future virtual entities

ğŸ—ï¸ ARCHITECTURE:

TWO-DOMAIN SEPARATION:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¥ MEDICAL DOMAIN                      â”‚
â”‚  - patient_id                           â”‚
â”‚  - appointment_id (NEW)                 â”‚
â”‚  - medical_record_id (NEW)              â”‚
â”‚                                         â”‚
â”‚  Integration: Patients â†’ Appointments   â”‚
â”‚               â†’ Medical Records         â”‚
â”‚               â†’ Documents               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’° ADMINISTRATIVE DOMAIN               â”‚
â”‚  - treatment_id (NEW)                   â”‚
â”‚  - purchase_order_id (NEW)              â”‚
â”‚  - subscription_id (NEW)                â”‚
â”‚                                         â”‚
â”‚  Integration: Billing â†’ Inventory       â”‚
â”‚               â†’ Marketplace             â”‚
â”‚               â†’ Documents (Virtual)     â”‚
â”‚               â†’ Patient Portal          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… VALIDATION:
- TypeScript compilation: PASSED (0 errors)
- All fields are OPTIONAL (backward compatible)
- Existing queries/mutations: UNAFFECTED
- Virtual Patient constants: DOCUMENTED

ğŸ”® FUTURE PHASES:

Phase 2 (During DAY 4-7):
- Medical Records: Add upload button (15 min)
- Patients: Add "Documentos" tab (20 min)
- Appointments: Add "Adjuntar" button (15 min)

Phase 3 (After Module 11):
- Billing â†” Documents integration (Virtual Patient)
- Billing â†” Inventory (materials tracking)
- Inventory â†” Marketplace (auto purchase orders)
- Patient Portal â†” Billing (Netflix Dental)

Phase 4 (After Module 11):
- Timeline unificada (patient view)
- Global search (all modules)
- RBAC permissions (Virtual Patient access control)

â±ï¸ TIME INVESTMENT:
- Planned: 30-60 minutes
- Actual: ~40 minutes
- Risk: LOW (optional fields only)

ğŸš€ PRODUCTION READY:
- Schema: FLEXIBLE and SCALABLE
- Virtual Patient: PROVEN concept (August 2025)
- Backward compatibility: MAINTAINED
- Integration: PREPARED

Next: DAY 4 - Medical Records Module
Then: Integrate upload buttons in Phase 2

---
Date: November 9, 2025
PunkClaude + Radwulf
Speed Run Mode: 321% efficiency maintained
